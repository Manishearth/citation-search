<html>
<head>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config(
                           {
                           "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] },
                           tex2jax: {
                           inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                           displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                           processEscapes: true,
                           ignoreClass: "tex2jax_ignore|dno"
                           },
                           TeX: {
                           noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
                           Macros: {
						      bold: ['{\\bf #1}', 1],
						      roman: ['{\\rm #1}', 1],
						      germ: ['{\\mathfrak #1}', 1]
							}
                           },
                           messageStyle: "none"
                           });
        </script>    
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <style>
    	a {
    		text-decoration: none;
		}
		tr td:first-child {padding-left:0px;}
 		td {padding:10px 0px 10px 50px;}
	</style>
</head>
<body>
<b>Search the mathematics literature</b>, by entering any combination of title, authors, and journal reference.<br/>
<input id="query" size=60/><img id="spinner" src="http://www.ajaxload.info/cache/FF/FF/FF/00/00/00/1-0.gif" style="display: none;"/>
<br/>
<table>
	<tr>
		<td valign="top">
			<span id="results">
			</span>
		</td>
		<td valign="top" id="article-display">
		
		</td>
	</tr>
</table>
<script>
var delay = (function(){
  var timer = 0;
  return function(callback, ms){
    clearTimeout (timer);
    timer = setTimeout(callback, ms);
  };
})();

function renderOptionalLink(href, text) {
	if(href) {
		return '<a href="' + href + '">' + text + '</a> ';
	} else {
		return '<span class="inactive">' + text + '</span> ';
	}
}

function callback(response) {
	if($("#query").val() == response.query) {
	   	var html = '<ol>\n';
	   	for (var i = 0; i < response.results.length; i++) {
	   		html += '<li><dt>' + 
		   		'<a href="' + response.results[i].url + '">' + 
			   		response.results[i].title + '</a>' +
		   		'</dt><dd>' + 
			   		response.results[i].authors + '<br/>' + response.results[i].cite  + '<br/>' +
			   		renderOptionalLink('http://www.ams.org/mathscinet-getitem?mr=' + response.results[i].MRNumber, 'mathscinet') +
			   		renderOptionalLink(response.results[i].url, 'journal') + 
			   		renderOptionalLink(response.results[i].pdf, 'pdf') + 
			   		renderOptionalLink(response.results[i].url, 'free') +
			   	'</dd></li>';
		   	}
	   	$("#results").empty();
	   	$("#article-display").empty()
	   	$("#results").append(html);
	   	MathJax.Hub.Queue(["Typeset",MathJax.Hub,"results"]);
	   	var iframeURL;
	   	if(response.results.length > 0) {
	   		if(response.results[0].free) {
	   			iframeURL = response.results[0].free
	   		} else { 
	       		if(response.results[0].pdf) {
	       			iframeURL = response.results[0].pdf
	       		} else {
	       			iframeURL = response.results[0].url
	       		}
	       	}
	       	$("#article-display").append('Loading ' + renderOptionalLink(iframeURL, iframeURL) + '<br/>');
	   		$("#article-display").append('<iframe width=1000 height=2000 src="' + iframeURL + '"/>');
	    }
	   	$("#spinner").hide();
	}	
}

$("#query").keyup(function () {
	delay(function() {
       	$.getJSON("http://polar-dawn-1849.herokuapp.com/?callback=?&q=" + $("#query").val(), callback);
      	$("#spinner").show();
       }, 500);
});
</script>
</body>
</html>